<section class="content-header" th:replace="component/header.html"></section>


<body>

	<h1 class="text-center">Consultar cliente</h1>

	<div id="zonaInsertar" class="text-center">

	</div>

	<div class="container">
		<div class="mb-3">
			<label for="id" class="form-label">ID Cliente</label>
			<input name="id" class="form-control id" id="id">
		</div>

		<button type="submit" class="btn btn-primary enviar">Enviar</button>
	</div>

	<p class="text-center">Volver al ménu principal <a href="../menu">aquí</a></p>
</body>

<script>

	const buttomSubmit = document.querySelector(".enviar");

	const zonaInserto = document.getElementById("zonaInsertar");


	buttomSubmit.addEventListener("click", function () {
		const id = document.querySelector(".id");

		const consumoApi = () => {

			fetch("/api/clients/" + id.value)

				.then(result => result.json())
				.then(data => {
					
					console.log(Object.keys(data).length);

					//SI ID NO ES MAYOR QUE 0 NO PINTO NADA
					if (id.value>0) {
						zonaInserto.innerHTML = '<table class="table"><thead><tr><th scope="col">ID</th><th scope="col">NOMBRE</th><th scope="col">APELLIDOS</th><th scope="col">FECHA NACIMIENTO</th><th scope="col">DNI</th></tr></thead><tbody><div id="isertarAqui"></div></tbody></table>';


						const zonaTabla = document.getElementsByTagName("tbody")[0];

						//ASIGNO VALORES EN CADA ITERACCIÓN
						let id = data.id;
						let name = data.name;
						let lastname = data.lastname;
						let birth = data.dateBirth;
						let dni = data.dni;

						//CREO FILA 
						const dataRow = document.createElement("tr");

						//CREO ETIQUETAS QUE CONTENDRÁN LOS DATOS
						const idArea = document.createElement("th");
						const nameArea = document.createElement("td");
						const lastnameArea = document.createElement("td");
						const birthArea = document.createElement("td");
						const dniArea = document.createElement("td");

						//ASIGNO ATRIBUTOS A LAS AREAS OPORTUNAS
						idArea.setAttribute("scope", "row");

						//ASIGNO VALOR A LA CELDA
						const idText = document.createTextNode(`${id}`);
						const nameText = document.createTextNode(`${name}`);
						const lastNameText = document.createTextNode(`${lastname}`);
						const birthText = document.createTextNode(`${birth}`);
						const dniText = document.createTextNode(`${dni}`);

						//UNO CELDA Y VALOR
						idArea.appendChild(idText);
						nameArea.appendChild(nameText);
						lastnameArea.appendChild(lastNameText);
						birthArea.appendChild(birthText);
						dniArea.appendChild(dniText);

						//UNO FILA Y CELDA
						dataRow.appendChild(idArea);
						dataRow.appendChild(nameArea);
						dataRow.appendChild(lastnameArea);
						dataRow.appendChild(birthArea);
						dataRow.appendChild(dniArea);

						//UNO FILA A CUERPO DE TABLA
						zonaTabla.appendChild(dataRow);
					} else {
						zonaInserto.innerHTML = "<h1 class='text-center text-danger'>No se encuentra clientes con ese ID</h1>"
					}

				})
				.catch(err => {
					zonaInserto.innerHTML = "<h1 class='text-center text-danger'>No se encuentra clientes con ese ID</h1>"
					console.log(err);
				})


		}

		
		consumoApi();
	})

</script>

<section class="content-footer" th:replace="component/footer.html"></section>